<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×××©×§ ×œ×•×‘×™ | ××¢×¨×›×ª ×’×¨×¤×™×§×” i24NEWS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --primary-blue: #3b82f6;
            --text-light: #f1f5f9;
            --card-bg: #1e293b;
            --header-strip-height: 50px;
        }
        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            padding-top: var(--header-strip-height);
        }

        /* ×¡×’× ×•×Ÿ ×•×™×“××• */
        .video-banner-container {
            position: relative;
            height: 300px;
            overflow: hidden;
            background-color: #0d1222;
        }
        #dynamic-banner-container {
            margin-top: calc(-1 * var(--header-strip-height));
        }
        .video-banner {
            position: absolute;
            top: 50%; left: 50%;
            min-width: 100%; min-height: 100%;
            transform: translate(-50%, -50%);
            object-fit: cover;
            z-index: 0;
        }
        .video-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); z-index: 1;
        }
        .video-content { position: relative; z-index: 2; }

        /* ×¡×’× ×•×Ÿ ×›×¨×˜×™×¡×™× */
        .card-image-wrapper { height: 200px; position: relative; overflow: hidden; }
        .template-image-wrapper { height: 120px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        .card-image {
            width: 100%; height: 100%; background-size: cover; background-position: center top;
            transition: transform 0.5s ease;
        }
        .presenter-card:hover .card-image { transform: scale(1.05); }
        .template-icon { width: 48px; height: 48px; color: white; opacity: 0.9; }

        /* ×¡×¨×’×œ ×¢×œ×™×•×Ÿ */
        #shortcut-strip {
            position: fixed; top: 0; right: 0; left: 0;
            height: var(--header-strip-height);
            background-color: #0f172a; /* ×¦×‘×¢ ×¨×§×¢ ××˜×•× */
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            display: flex; align-items: center; padding-right: 1rem;
            border-bottom: 1px solid #334155;
        }

        /* ×ª×¤×¨×™×˜ × ×¤×ª×— */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%; right: 0;
            width: 250px;
            background-color: #1e293b;
            border: 1px solid #475569;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            flex-direction: column;
            z-index: 1001;
            max-height: 80vh;
            overflow-y: auto;
        }
        .dropdown-menu.show { display: flex; }
        .dropdown-item {
            padding: 12px 16px;
            text-align: right;
            color: #e2e8f0;
            border-bottom: 1px solid #334155;
            transition: all 0.2s;
            cursor: pointer;
            border-right: 4px solid transparent;
        }
        .dropdown-item:hover { background-color: #334155; }
        
        /* ×›×¤×ª×•×¨ ×¤×ª×™×—×ª ×ª×¤×¨×™×˜ */
        .menu-btn {
            display: flex; align-items: center; gap: 8px;
            color: white; font-weight: bold; cursor: pointer;
            padding: 8px 12px; border-radius: 6px;
            transition: background 0.2s;
        }
        .menu-btn:hover { background-color: #334155; }

        /* ×›×œ×œ×™ */
        .hidden { display: none !important; }
        
        /* ××¦×‘ ×™×•× */
        .light-mode { background-color: #f1f5f9; color: #0f172a; }
        .light-mode .dropdown-menu { background-color: white; border-color: #cbd5e1; }
        .light-mode .dropdown-item { color: #334155; border-bottom-color: #e2e8f0; }
        .light-mode .dropdown-item:hover { background-color: #f1f5f9; }
        .light-mode #shortcut-strip { background-color: white; border-bottom-color: #cbd5e1; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .light-mode .menu-btn { color: #0f172a; }
        .light-mode .menu-btn:hover { background-color: #e2e8f0; }
        
        /* ×¡×’× ×•× ×•×ª ×˜×•×¤×¡ ×‘×¡×™×¡×™×™× */
        .input-style {
            width: 100%; padding: 10px; border-radius: 6px;
            background-color: #334155; border: 1px solid #475569; color: white;
            margin-bottom: 10px;
        }
        .light-mode .input-style { background-color: #f8fafc; border-color: #cbd5e1; color: #0f172a; }
        
    </style>
</head>
<body class="min-h-screen">

    <!-- ×¡×¨×’×œ ×¢×œ×™×•×Ÿ ×¢× ×ª×¤×¨×™×˜ -->
    <nav id="shortcut-strip">
        <div class="relative">
            <button onclick="toggleMenu(event)" class="menu-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
                <span>×‘×—×™×¨×ª ××”×“×•×¨×”</span>
            </button>
            <!-- ×¨×©×™××ª ×”××”×“×•×¨×•×ª (×ª×¤×¨×™×˜ ×× ×›×™) -->
            <div id="main-dropdown" class="dropdown-menu">
                <!-- ×”×ª×•×›×Ÿ ×™×•×–×¨×§ ×›××Ÿ ×¢"×™ JS -->
            </div>
        </div>
    </nav>

    <!-- ×‘×× ×¨ ×•×™×“××• -->
    <div id="dynamic-banner-container" class="video-banner-container">
        <video id="banner-video" autoplay muted loop class="video-banner">
            <source id="banner-video-source" src="" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
        <div class="video-content flex flex-col justify-center items-center h-full text-center p-4">
            <h1 class="text-4xl font-bold text-white mb-2 shadow-lg">××¢×¨×›×ª ×©×™×’×•×¨ ×’×¨×¤×™×§×”</h1>
            <p class="text-xl text-gray-200">i24NEWS Production</p>
            <div id="banner-titles" class="mt-4">
                <h2 id="banner-title" class="text-3xl font-bold text-white"></h2>
                <p id="banner-subtitle" class="text-lg text-gray-300"></p>
            </div>
        </div>
    </div>

    <!-- ×ª×•×›×Ÿ ×¨××©×™ -->
    <main class="max-w-7xl mx-auto p-4 md:p-8 relative z-10">
        
        <!-- 1. ××¡×š ×”×œ×•×‘×™ -->
        <div id="lobby-view" class="mt-6">
            <div id="presenters-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        </div>

        <!-- 2. ××¡×š ×‘×—×™×¨×ª ×ª×‘× ×™×ª -->
        <div id="template-lobby-view" class="hidden">
            <button onclick="showLobby()" class="flex items-center text-gray-400 hover:text-blue-400 mb-6 font-bold transition">
                <span class="text-xl ml-2">&#8594;</span> ×—×–×•×¨ ×œ×‘×—×™×¨×ª ××”×“×•×¨×”
            </button>
            <div id="templates-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
        </div>

        <!-- 3. ××¡×š ×˜×•×¤×¡ ×‘×•×œ×˜×™× -->
        <div id="bullets-form-view" class="hidden">
            <button onclick="showTemplateLobby()" class="flex items-center text-gray-400 hover:text-blue-400 mb-6 font-bold transition">
                <span class="text-xl ml-2">&#8594;</span> ×—×–×•×¨ ×œ×‘×—×™×¨×ª ×ª×‘× ×™×ª
            </button>
            
            <div class="max-w-3xl mx-auto p-6 rounded-xl shadow-2xl bg-[#1e293b] border border-gray-700" id="form-card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white" id="main-form-title">×˜×•×¤×¡ ×”×–×× ×”</h2>
                    <div class="flex gap-2">
                        <button onclick="saveFormAsText()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-bold">×©××•×¨</button>
                        <button onclick="toggleDarkMode()" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded text-sm font-bold">×™×•×/×œ×™×œ×”</button>
                    </div>
                </div>
                
                <form id="orderForm" class="space-y-6">
                    <!-- ×¤×¨×˜×™× -->
                    <div class="p-4 border border-gray-600 rounded-lg">
                        <h3 class="text-lg font-bold text-blue-400 mb-4 border-b border-gray-600 pb-2">×¤×¨×˜×™ ×”×–×× ×”</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="sender-name" class="input-style" placeholder="×©× ×”×©×•×œ×—">
                            <input type="text" id="edition-name" class="input-style" placeholder="×©× ×”××”×“×•×¨×”">
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-2">
                            <div id="fixed-broadcast-date" class="input-style flex items-center bg-gray-700 cursor-not-allowed"></div>
                            <div id="fixed-estimated-time" class="input-style flex items-center bg-gray-700 cursor-not-allowed"></div>
                        </div>
                    </div>

                    <!-- ×ª×•×›×Ÿ ×“×™× ××™ -->
                    <div id="dynamic-content-section" class="p-4 border border-gray-600 rounded-lg"></div>

                    <!-- ×”×¢×¨×•×ª -->
                    <div>
                        <h3 class="text-lg font-bold text-gray-400 mb-2">×”×¢×¨×•×ª × ×•×¡×¤×•×ª</h3>
                        <textarea id="notes" class="input-style h-24" placeholder="×”×¢×¨×•×ª ×œ×’×¨×¤×™×§××™..."></textarea>
                    </div>
                </form>
            </div>
        </div>

        <!-- ×œ×•×’×™× -->
        <div id="active-requests-view" class="mt-12 pt-6 border-t border-gray-700">
            <h2 class="text-2xl font-bold text-white mb-4">×ª×™×¢×•×“ ×©×™×’×•×¨×™× ××—×¨×•× ×™×</h2>
            <div id="requests-list" class="space-y-3">
                <p class="text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
            </div>
        </div>

    </main>

    <!-- ×¡×§×¨×™×¤×˜ ×¨××©×™ (×œ×•×’×™×§×” ×•×ª×¦×•×’×” - × ×˜×¢×Ÿ ××™×“) -->
    <script>
        // × ×ª×•× ×™×
        const SHOWS = [
            { name: '×”××”×“×•×¨×” ×”××¨×›×–×™×ª', presenter: '××™×¨×™ ××™×›××œ×™ ×•×“× ×™××œ ×¨×•×˜-××‘× ×¨×™', role: '20:00', color: '#ef4444', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%9E%D7%99%D7%A8%D7%99_%D7%9E%D7%99%D7%9B%D7%90%D7%9C%D7%99_%D7%92%D7%93%D7%95%D7%9C.png', id: 'main' },
            { name: '×§×‘×™× ×˜ ×©×™×©×™', presenter: '× ×•×” ×“×¨×•××™', role: '×©×™×©×™ 19:53', color: '#f97316', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%A0%D7%95%D7%95%D7%94_%D7%93%D7%A8%D7%95%D7%9E%D7%99_%D7%92%D7%93%D7%95%D7%9C.png', id: 'fri' },
            { name: '××’×–×™×Ÿ ×”×©×‘×ª', presenter: '××™×›×œ ×¨×‘×™× ×•×‘×™×¥×³', role: '×©×‘×ª 19:50', color: '#22c55e', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%9E%D7%99%D7%9B%D7%9C_%D7%A8%D7%91%D7%99%D7%A0%D7%95%D7%91%D7%99%D7%A5_THUMB.png', id: 'sat' },
            { name: '×”××”×“×•×¨×” ×”××•×§×“××ª', presenter: '×©×¨×•×Ÿ ×’×œ', role: '19:00', color: '#eab308', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%A9%D7%A8%D7%95%D7%9F_%D7%92%D7%9C_THUMB.png', id: 'early' },
            { name: '××“×“ ×’×œ×‘×•×¢', presenter: '× ×™×‘ ×’×œ×‘×•×¢', role: '18:00', color: '#6366f1', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%A0%D7%99%D7%91_%D7%92%D7%9C%D7%91%D7%95%D7%A2.png', id: 'gilboa' },
            { name: '××”×“×•×¨×ª ×—××©', presenter: '×©×¨×•×Ÿ × ×™×¡×™×', role: '17:00', color: '#8b5cf6', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%A9%D7%A8%D7%95%D7%9F_%D7%A0%D7%99%D7%A1%D7%99%D7%9D.png', id: 'five' },
            { name: '×”×¢×¨×‘×™×¡×˜×™×', presenter: '×¦×‘×™ ×™×—×–×§××œ×™', role: '×—××™×©×™ ×•×©×‘×ª', color: '#ec4899', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%A6%D7%91%D7%99%D7%A7%D7%94_%D7%99%D7%97%D7%96%D7%A7%D7%9C%D7%99.png', id: 'arab' },
            { name: '×”×™×©×¨××œ×™×', presenter: '××•×¨×™ ×§×•××œ', role: '××—×¨×™ ×”××¨×›×–×™×ª', color: '#3b82f6', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%90%D7%95%D7%A8%D7%99_%D7%A7%D7%95%D7%95%D7%90%D7%9C.png', id: 'isra' },
            { name: '××“×‘×¨×™× ×—×“×©×•×ª', presenter: '××œ×™×¨×– ×©×“×”', role: '23:00', color: '#06b6d4', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%90%D7%9C%D7%99%D7%A8%D7%96_%D7%A9%D7%93%D7%94.png', id: 'talk' },
            { name: '××”×“×•×¨×ª ×¦×”×¨×™×™×', presenter: '×“× ×™××œ ×¨×•×˜-××‘× ×¨×™', role: '12:00', color: '#10b981', img: 'https://raw.githubusercontent.com/orengamchi/i24_gui_v2/main/%D7%93%D7%A0%D7%99%D7%90%D7%9C_%D7%A8%D7%95%D7%98_%D7%92%D7%93%D7%95%D7%9C.png', id: 'noon' },
            { name: '×—×“×¨ ×”×—×“×©×•×ª', presenter: '×¦×•×•×ª ×”×›×ª×‘×™×', role: '×›×œ ×©×¢×”', color: '#f43f5e', img: 'https://placehold.co/400x400/374151/f1f5f9?text=NEWS', id: 'news' }
        ];

        const TEMPLATES = [
            { name: '×ª×‘× ×™×ª ×¡×˜×•×¨×™', id: 'Story', icon: 'ğŸ“±', color: 'border-orange-500' },
            { name: '×ª×‘× ×™×ª ××¦×’×ª', id: 'Presentation', icon: 'ğŸ“º', color: 'border-blue-500' },
            { name: '×ª×‘× ×™×ª ×××¡×˜×¨', id: 'Master', icon: 'ğŸ›ï¸', color: 'border-red-500' },
            { name: '×ª×‘× ×™×ª ×ª××œ×•×œ', id: 'Transcript', icon: 'ğŸ“', color: 'border-green-500' },
            { name: '×ª×‘× ×™×ª ×¡×•×©×™××œ', id: 'SocialMedia', icon: 'ğŸ‘', color: 'border-purple-500' },
            { name: '×ª×‘× ×™×ª ×¢×™×ª×•×Ÿ', id: 'Newspaper', icon: 'ğŸ“°', color: 'border-yellow-500' },
            { name: '×ª×‘× ×™×ª ×‘×•×œ×˜×™×', id: 'Bullets', icon: 'ğŸ“‹', color: 'border-teal-500' }
        ];

        let currentShow = null;

        // ××ª×—×•×œ ××™×™×“×™ ×©×œ ×”×ª×¦×•×’×”
        document.addEventListener('DOMContentLoaded', () => {
            renderMenu();
            renderLobby();
            updateTime();
            setInterval(updateTime, 1000);
        });

        // ×¤×•× ×§×¦×™×•×ª ×ª×¦×•×’×”
        function toggleMenu(e) {
            e.stopPropagation();
            document.getElementById('main-dropdown').classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#shortcut-strip')) {
                document.getElementById('main-dropdown').classList.remove('show');
            }
        });

        function renderMenu() {
            const menu = document.getElementById('main-dropdown');
            menu.innerHTML = SHOWS.map(show => `
                <div class="dropdown-item" 
                     onclick="selectShow('${show.id}'); document.getElementById('main-dropdown').classList.remove('show')"
                     onmouseover="this.style.borderRightColor='${show.color}'"
                     onmouseout="this.style.borderRightColor='transparent'">
                    ${show.name}
                </div>
            `).join('');
        }

        function renderLobby() {
            const grid = document.getElementById('presenters-grid');
            grid.innerHTML = SHOWS.map(show => `
                <div onclick="selectShow('${show.id}')" class="presenter-card bg-[#1e293b] rounded-xl overflow-hidden cursor-pointer shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 border-b-4" style="border-color: ${show.color}">
                    <div class="card-image-wrapper">
                        <div class="card-image" style="background-image: url('${show.img}')"></div>
                    </div>
                    <div class="p-4">
                        <h3 class="text-xl font-bold text-white">${show.name}</h3>
                        <p class="text-gray-400 text-sm">${show.presenter}</p>
                    </div>
                </div>
            `).join('');
        }

        function selectShow(showId) {
            currentShow = SHOWS.find(s => s.id === showId);
            document.getElementById('lobby-view').classList.add('hidden');
            document.getElementById('bullets-form-view').classList.add('hidden');
            document.getElementById('template-lobby-view').classList.remove('hidden');
            
            // ×¢×“×›×•×Ÿ ×‘×× ×¨
            updateBanner('×‘×—×¨ ×ª×‘× ×™×ª ×’×¨×¤×™×ª', `×¢×‘×•×¨: ${currentShow.name}`);
            renderTemplates();
        }

        function showLobby() {
            document.getElementById('template-lobby-view').classList.add('hidden');
            document.getElementById('bullets-form-view').classList.add('hidden');
            document.getElementById('lobby-view').classList.remove('hidden');
            updateBanner('××¢×¨×›×ª ×©×™×’×•×¨ ×’×¨×¤×™×§×”', 'i24NEWS Production');
        }

        function renderTemplates() {
            const grid = document.getElementById('templates-grid');
            grid.innerHTML = TEMPLATES.map(t => `
                <div onclick="openTemplate('${t.id}')" class="bg-[#1e293b] rounded-xl p-4 cursor-pointer shadow-md hover:bg-[#334155] border-b-4 ${t.color} transition text-center">
                    <div class="text-4xl mb-2">${t.icon}</div>
                    <h3 class="text-white font-bold">${t.name}</h3>
                </div>
            `).join('');
        }

        function showTemplateLobby() {
            document.getElementById('bullets-form-view').classList.add('hidden');
            document.getElementById('template-lobby-view').classList.remove('hidden');
        }

        function openTemplate(type) {
            if (type === 'Bullets') {
                document.getElementById('template-lobby-view').classList.add('hidden');
                document.getElementById('bullets-form-view').classList.remove('hidden');
                
                // ×¢×“×›×•×Ÿ ×˜×•×¤×¡
                document.getElementById('edition-name').value = currentShow.name;
                const formCard = document.getElementById('form-card');
                formCard.style.borderTop = `4px solid ${currentShow.color}`;
                document.querySelector('#bullets-form-view h2').style.color = currentShow.color;
                
                renderBulletsFields();
            } else {
                // ×¤×ª×™×—×ª ×§×™×©×•×¨ ×—×™×¦×•× ×™ (×¡×™××•×œ×¦×™×”)
                const url = `https://your-github-repo.com/forms/template_${type}.html?show=${encodeURIComponent(currentShow.name)}`;
                window.open(url, '_blank');
                logRequest(type, url, '×—×™×¦×•× ×™');
            }
        }

        function renderBulletsFields() {
            const container = document.getElementById('dynamic-content-section');
            container.innerHTML = `
                <h3 class="text-lg font-bold text-gray-300 mb-4 border-b border-gray-600 pb-2">×ª×•×›×Ÿ ×‘×•×œ×˜×™×</h3>
                <div class="mb-4">
                    <label class="text-sm text-gray-400">×›×•×ª×¨×ª ×¨××©×™×ª (×¢×“ 15 ×ª×•×•×™×)</label>
                    <input type="text" class="input-style font-bold text-lg" placeholder="×›×•×ª×¨×ª...">
                </div>
                <div class="space-y-2">
                    <input type="text" class="input-style" placeholder="×¡×¢×™×£ 1...">
                    <input type="text" class="input-style" placeholder="×¡×¢×™×£ 2...">
                    <input type="text" class="input-style" placeholder="×¡×¢×™×£ 3...">
                </div>
            `;
        }

        function updateBanner(title, subtitle) {
            document.getElementById('banner-title').textContent = title;
            document.getElementById('banner-subtitle').textContent = subtitle;
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('fixed-broadcast-date').textContent = now.toLocaleDateString('he-IL');
            document.getElementById('fixed-estimated-time').textContent = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
        }

        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            const card = document.getElementById('form-card');
            if(card) card.style.backgroundColor = isLight ? '#ffffff' : '#1e293b';
        }

        function saveFormAsText() {
            const text = `×”×–×× ×” ×¢×‘×•×¨: ${currentShow?.name}\n×ª××¨×™×š: ${new Date().toLocaleString()}\n...`;
            const blob = new Blob([text], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'order.txt';
            a.click();
            logRequest('Bullets', 'internal', '×¤× ×™××™');
        }

        // Firebase Logging Helper (××•×’×“×¨ ×’×œ×•×‘×œ×™×ª ×›×“×™ ×©×”××•×“×•×œ ×™×©×ª××© ×‘×•)
        window.logRequest = function(type, url, status) {
            console.log(`Logging request: ${type} - ${status}`);
            // ×”×œ×•×’×™×§×” ×”×××™×ª×™×ª × ××¦××ª ×‘××•×“×•×œ ×œ××˜×”
            if (window.app && window.app.logToFirebase) {
                window.app.logToFirebase(type, url, status);
            }
        };

    </script>

    <!-- ×¡×§×¨×™×¤×˜ Firebase (××•×¤×¨×“ ×›×“×™ ×œ×× ×•×¢ ×§×¨×™×¡×”) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // ×¤×•× ×§×¦×™×™×ª ×œ×•×’
            window.app = window.app || {};
            window.app.logToFirebase = async (type, url, status) => {
                if (!auth.currentUser) return;
                try {
                    await addDoc(collection(db, `/artifacts/${appId}/public/data/graphics_requests_log`), {
                        show: document.getElementById('edition-name').value || '×›×œ×œ×™',
                        templateType: type,
                        reporterId: auth.currentUser.uid,
                        externalUrl: url,
                        timestamp: serverTimestamp(),
                        status: status
                    });
                } catch (e) { console.error("Log error", e); }
            };

            // Auth Flow
            const initAuth = async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Auth Failed", error);
                }
            };

            initAuth().then(() => {
                 onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // Start Listener only after auth
                        const q = query(collection(db, `/artifacts/${appId}/public/data/graphics_requests_log`), orderBy('timestamp', 'desc'));
                        onSnapshot(q, (snapshot) => {
                            const list = document.getElementById('requests-list');
                            if(!list) return; // Guard against missing element
                            if(snapshot.empty) { list.innerHTML = '<p class="text-gray-500">××™×Ÿ × ×ª×•× ×™×</p>'; return; }
                            
                            list.innerHTML = snapshot.docs.slice(0, 5).map(doc => {
                                const data = doc.data();
                                const time = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleTimeString() : '';
                                return `
                                    <div class="bg-gray-800 p-3 rounded flex justify-between border-r-4 border-blue-500">
                                        <span>${data.templateType} - ${data.show}</span>
                                        <span class="text-xs text-gray-400">${time}</span>
                                    </div>
                                `;
                            }).join('');
                        }, (error) => {
                            console.error("Snapshot error:", error);
                            // Squelch permission errors in UI, just log to console
                        });
                    }
                 });
            });
        }
    </script>
</body>
</html>