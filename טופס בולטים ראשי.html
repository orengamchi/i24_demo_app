<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×˜×•×¤×¡ ×”×–×× ×” - ×××¡×˜×¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ××ª×•×š ×§×•×“ ×”×œ×•×‘×™ */
        :root {
            --bg-app: #0f172a; /* Slate 900 - ×¨×§×¢ ×›×œ×œ×™ ×©×œ ×”××¤×œ×™×§×¦×™×” (×¨×§×¢ ×©×œ ×”-body) */
            --primary-blue: #3b82f6; /* Blue 500 - ×›×—×•×œ ×¨××©×™ */
            --text-light: #f1f5f9; /* Slate 100 - ×˜×§×¡×˜ ×‘×”×™×¨ */
            --card-bg: #1e293b; /* Slate 800 - ×¨×§×¢ ×”×›×¨×˜×™×¡ ×”×¨××©×™ ×©×œ ×”×˜×•×¤×¡ */
            --card-bg-light: #334155; /* Slate 700 - ×¨×§×¢ ×œ××¦×‘ ×‘×”×™×¨ */
            --border-color: #475569; /* Slate 600 */
        }

        /* ×”×’×“×¨×•×ª ×’×œ×•×‘×œ×™×•×ª - ××•×’×“×¨ ×›×‘×¨×™×¨×ª ××—×“×œ ×›"××¦×‘ ×›×”×”" ×›×“×™ ×œ×”×ª××™× ×œ×œ×•×‘×™ */
        body {
            font-family: 'Heebo', sans-serif;
            direction: rtl; 
            text-align: right;
            transition: background-color 0.3s;
            background-color: var(--bg-app); /* ×¨×§×¢ ××¤×œ×™×§×¦×™×” */
            color: var(--text-light);
            
            /* ×¨×§×¢ ×’×¨×™×“ ×›×”×” - ××•×ª×× ×œ×¦×‘×¢ ×”-app-bg */
            background-image: linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px);
            background-size: 20px 20px; 
        }
        
        /* ×”×’×“×¨×•×ª ×œ×˜×•×¤×¡ ×‘××¦×‘ ×›×”×” (×‘×¨×™×¨×ª ××—×“×œ) */
        .order-form {
            background-color: var(--card-bg); /* ×¨×§×¢ ×”×›×¨×˜×™×¡ */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
        }
        .section-title { 
            color: var(--primary-blue); 
            border-bottom-color: var(--primary-blue); 
        }
        .input-style { 
            background-color: #334155; /* Slate 700 - ×©×“×” ×§×œ×˜ ×›×”×” */
            border-color: var(--border-color);
            color: var(--text-light); 
        }
        .input-style::placeholder {
            color: #94a3b8; /* Slate 400 */
        }
        .input-style:focus { 
            border-color: var(--primary-blue); 
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); 
        }
        .readonly-info { 
            background-color: #0f172a !important; 
            border-color: var(--border-color) !important;
            color: var(--text-light) !important;
        }

        /* ********************************* */
        /* ××¦×‘ ×‘×”×™×¨ (light-mode) - ×¡×’× ×•×Ÿ ××©×•×¤×¨ (×ª×™×‘×•×ª ×©×™×— ×‘××¤×•×¨ ×‘×”×™×¨) */
        /* ********************************* */
        .light-mode body {
            background-color: #f1f5f9; /* Slate 100 */
            color: #0f172a;
            background-image: linear-gradient(to right, #e2e8f0 1px, transparent 1px), linear-gradient(to bottom, #e2e8f0 1px, transparent 1px);
        }
        .light-mode .order-form {
            background-color: #ffffff; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .light-mode .section-title { 
            color: #1e3a8a; /* ×›×—×•×œ ×›×”×” ×™×•×ª×¨ */
            border-bottom-color: #94a3b8; /* ×’×‘×•×œ ××¤×•×¨ ×‘×”×™×¨ */
        }
        .light-mode .input-style {
            background-color: #f8fafc; /* ××¤×•×¨ ×‘×”×™×¨ ×××•×“ ×œ×ª×™×‘×•×ª ×©×™×— */
            border-color: #cbd5e1; /* Slate 300 - ×’×‘×•×œ ×‘×”×™×¨ ×™×•×ª×¨ */
            color: #0f172a;
        }
        .light-mode .input-style:focus {
            border-color: #94a3b8; /* ×’×‘×•×œ ×¤×•×§×•×¡ ××¤×•×¨-×›×—×•×œ ×¢×“×™×Ÿ */
            box-shadow: 0 0 0 2px rgba(148, 163, 184, 0.3); /* ×¦×œ ×¤×•×§×•×¡ ×¢×“×™×Ÿ */
        }
        .light-mode .readonly-info { 
            background-color: #e2e8f0 !important; /* ××¤×•×¨ ×‘×”×™×¨ ×œ×¨×›×™×‘×™ ×§×¨×™××” ×‘×œ×‘×“ */
            border-color: #cbd5e1 !important;
            color: #1e293b !important;
        }


        /* ×¡×’× ×•× ×•×ª ×›×œ×œ×™×™× ×œ×©×“×•×ª ×¡×¤×¦×™×¤×™×™× */
        .clear-button { @apply px-2 py-1 bg-red-500 text-white text-xs font-semibold rounded-lg hover:bg-red-600 transition duration-150; }
        .cancelled input[type="text"], .cancelled .input-style { background-color: #581c1c !important; border-color: #ef4444 !important; opacity: 0.6; text-decoration: line-through; color: #fca5a5; }
        .light-mode .cancelled input[type="text"], .light-mode .cancelled .input-style { background-color: #fdd !important; border-color: #f00 !important; color: #721c24; }
        .notes-container { @apply border-transparent !important; }
        .section-input-style { width: 80%; font-size: 1.05em; margin-right: auto; margin-left: auto; }

    </style>
</head>
<body class="p-4 sm:p-8">

<div id="form-container" class="max-w-3xl mx-auto bg-card-bg p-6 sm:p-8 rounded-xl shadow-2xl order-form">
    
    <header class="text-center mb-6 flex justify-between items-center flex-wrap gap-4">
        <h1 id="main-form-title" class="text-3xl sm:text-4xl font-extrabold text-white mb-1">
            ğŸ“ ×˜×•×¤×¡ ×”×–×× ×” - ×‘×•×œ×˜×™×
        </h1>
        <div class="flex space-x-2 space-x-reverse">
            <button onclick="saveFormAsText()" class="action-button text-sm bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg px-4 py-2">
                ğŸ’¾ ×©××•×¨ ×›×§×•×‘×¥ ×˜×§×¡×˜ (.txt)
            </button>
            <button onclick="toggleDarkMode()" class="mode-toggle-button text-sm bg-gray-600 hover:bg-gray-500 text-white font-bold rounded-lg px-4 py-2">
                â˜€ï¸ ××¦×‘ ×™×•×
            </button>
        </div>
    </header>
    <p id="live-datetime" class="text-gray-400 text-sm mb-6 text-center"></p>
    
    <form id="orderForm">

        <!-- ×¤×¨×˜×™ ×”×–×× ×” ×§×‘×•×¢×™× -->
        <div class="mb-8 p-4 border border-border-color rounded-lg">
            <h2 class="section-title">×¤×¨×˜×™ ×”×–×× ×”</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="sender-name" class="block text-sm font-medium text-gray-300 mb-1">×©× ×”×©×•×œ×—/×›×ª×‘:</label>
                    <input type="text" id="sender-name" class="input-style" placeholder="×”×§×œ×“ ×›××Ÿ" required>
                </div>
                <div class="form-group">
                    <label for="edition-name" class="block text-sm font-medium text-gray-300 mb-1">×©× ×”××”×“×•×¨×”:</label>
                    <input type="text" id="edition-name" class="input-style" placeholder="×”×§×œ×“ ×›××Ÿ" required>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-300 mb-1">×ª××¨×™×š ×©×™×“×•×¨ ×§×‘×•×¢:</label>
                    <div class="input-style readonly-info bg-gray-100 text-gray-600 font-semibold cursor-default" id="fixed-broadcast-date">3.12.2025</div>
                </div>
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-300 mb-1">×©×¢×ª ×©×™×“×•×¨ ××©×•×¢×¨×ª ×§×‘×•×¢×”:</label>
                    <div class="input-style readonly-info bg-gray-100 text-gray-600 font-semibold cursor-default" id="fixed-estimated-time">10:11</div>
                </div>
            </div>
        </div>

        <!-- ×§×‘×¦×™× ××¦×•×¨×¤×™× ×§×‘×•×¢×™× -->
        <div class="mb-8 p-4 border border-border-color rounded-lg">
            <h2 class="section-title">×§×‘×¦×™× ××¦×•×¨×¤×™× (×¡××Ÿ ×× ×¨×œ×•×•× ×˜×™)</h2>
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex items-center space-x-2 space-x-reverse">
                    <input type="checkbox" id="audio-file" data-label="×§×•×‘×¥ ××•×“×™×• (×§×¨×™×™× ×•×ª ×œ×’×¨×¤×™×§×”)" class="attachment-checkbox h-4 w-4 text-blue-500 border-gray-600 rounded focus:ring-blue-500">
                    <label for="audio-file" class="block text-sm text-gray-300">×§×•×‘×¥ ××•×“×™×• (×§×¨×™×™× ×•×ª ×œ×’×¨×¤×™×§×”)</label>
                </div>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <input type="checkbox" id="image-file" data-label="×ª××•× ×” (×¨×§×¢ ××• ××™×œ×•×¡×˜×¨×¦×™×”)" class="attachment-checkbox h-4 w-4 text-blue-500 border-gray-600 rounded focus:ring-blue-500">
                    <label for="image-file" class="block text-sm text-gray-300">×ª××•× ×” (×¨×§×¢ ××• ××™×œ×•×¡×˜×¨×¦×™×”)</label>
                </div>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <input type="checkbox" id="video-file" data-label="×§×•×‘×¥ ×•×™×“××•" class="attachment-checkbox h-4 w-4 text-blue-500 border-gray-600 rounded focus:ring-blue-500">
                    <label for="video-file" class="block text-sm text-gray-300">×§×•×‘×¥ ×•×™×“××•</label>
                </div>
            </div>
        </div>

        <!-- ***** ×ª×•×›×Ÿ ×’×¨×¤×™×§×” (×“×™× ××™) ***** -->
        <div id="dynamic-content-section" class="mb-8 p-4 border border-border-color rounded-lg">
            <h2 class="section-title">×ª×•×›×Ÿ ×”×’×¨×¤×™×§×” (× × ×œ××œ× ×‘××“×•×™×§)</h2>
            <!-- ×”×©×“×•×ª ×™×¨×•× ×“×¨×• ×›××Ÿ ×¢×œ ×™×“×™ JavaScript ×‘×”×ª×× ×œ×ª×‘× ×™×ª -->
        </div>

        <!-- ×”×¢×¨×•×ª × ×•×¡×¤×•×ª - ×¨×•×—×‘ ××œ×, ×’×•×‘×” 4 ×©×•×¨×•×ª, ××•×’×‘×œ ×œ-300 ×ª×•×•×™× -->
        <div class="p-4 rounded-lg notes-container">
            <h2 class="section-title">×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×¨×¤×™×§××™ (×¦×‘×¢×™×/×¡×’× ×•×Ÿ/×“×’×©×™×)</h2>
            <div class="form-group">
                <label for="notes" class="block text-sm font-medium text-gray-300 sr-only">×”×¢×¨×•×ª × ×•×¡×¤×•×ª</label>
                <textarea id="notes" class="input-style" rows="4" maxlength="300" placeholder="×”×§×œ×“ ×›××Ÿ ×”×¢×¨×•×ª ××™×•×—×“×•×ª, ×“×’×©×™× ×¢×œ ×¦×‘×¢×™× ××• ×¡×’× ×•×Ÿ ×’×¨×¤×™ ×¨×¦×•×™... (××§×¡×™××•× 300 ×ª×•×•×™×)"></textarea>
            </div>
        </div>
    </form>
    
    <!-- ×–×›×•×™×•×ª ×™×•×¦×¨×™× -->
    <footer class="mt-8 text-center text-xs text-gray-500">
        &copy; OREN GAMCHI
    </footer>

</div>

<script>
    // ×”×’×“×¨×•×ª ×ª×¦×•×¨×” ×œ×›×œ ×ª×‘× ×™×ª (Configuration - × ×™×ª×Ÿ ×œ×”×¢×‘×™×¨ ×‘×”××©×š ×œ-Firestore)
    const templateConfigs = {
        'Bullets': {
            title: '×˜×•×¤×¡ ×”×–×× ×” - ×‘×•×œ×˜×™×',
            fields: [
                { id: 'main-title', label: '×›×•×ª×¨×ª ×¨××©×™×ª', lines: 2, maxLen: 15, isBold: true, defaultValue: 'XVXVXVXVXVXV' },
                { id: 'subtitle', label: '×›×•×ª×¨×ª ××©× ×”', lines: 2, maxLen: 15, isBold: false, defaultValue: '×“×›×“×›×“×›×“×›×“' },
                { id: 'section1', label: '×¡×¢×™×£ 1', lines: 2, maxLen: 30, defaultValue: '×× ×™ ×¢×œ ×–×” ×¢×“×™×™×Ÿ' },
                { id: 'section2', label: '×¡×¢×™×£ 2', lines: 2, maxLen: 30, defaultValue: '×“×›×“×›×“×›×“×›×“' },
                { id: 'section3', label: '×¡×¢×™×£ 3', lines: 2, maxLen: 30, defaultValue: '×”×–××Ÿ ×˜×§×¡×˜ ×œ×§×¨×™×™× ×•×ª.' },
            ]
        },
        'Story': {
            title: '×˜×•×¤×¡ ×”×–×× ×” - ×¡×˜×•×¨×™',
            fields: [
                { id: 'story-title', label: '×›×•×ª×¨×ª ×¨××©×™×ª ×œ×¡×˜×•×¨×™', lines: 1, maxLen: 40, isBold: true },
                { id: 'sub-title', label: '×›×•×ª×¨×ª ××©× ×”', lines: 1, maxLen: 40 },
                { id: 'long-text', label: '×˜×§×¡×˜ ×œ×¡×˜×•×¨×™ (×¤×™×¡×§×”)', lines: 5, maxLen: 300, isTextArea: true },
            ]
        },
        'LowerThird': {
            title: '×˜×•×¤×¡ - ×›×•×ª×¨×ª ×ª×—×ª×•× ×”',
            fields: [
                { id: 'name', label: '×©× ×”××•×¤×™×¢', lines: 1, maxLen: 25, isBold: true },
                { id: 'title', label: '×ª×¤×§×™×“ / ×›×•×ª×¨×ª ×ª×—×ª×•× ×”', lines: 1, maxLen: 35 },
            ]
        }
        // × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›××Ÿ ×ª×‘× ×™×•×ª × ×•×¡×¤×•×ª
    };

    let activeConfig = templateConfigs.Bullets; // ×‘×¨×™×¨×ª ××—×“×œ

    // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×”×©×¢×” ×•×”×ª××¨×™×š ×‘×–××Ÿ ×××ª
    function updateLiveDateTime() {
        const now = new Date();
        const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
        
        const dateString = now.toLocaleDateString('he-IL', dateOptions);
        const timeString = now.toLocaleTimeString('he-IL', timeOptions);
        
        document.getElementById('live-datetime').textContent = `×©×¢×” ×•×ª××¨×™×š × ×•×›×—×™×™×: ${dateString} | ${timeString}`;
    }

    // ×¤×•× ×§×¦×™×” ×œ×”×¤×¢×œ×ª × ×™×•×•×˜ ×‘×××¦×¢×•×ª ××§×© Enter ×‘×™×Ÿ ×”×©×“×•×ª ×”××•×’×‘×œ×™×
    function setupEnterKeyNavigation() {
        // ××•×¡×£ ××ª ×›×œ ×©×“×•×ª ×”×§×œ×˜ ×‘×˜×•×¤×¡ ×”×“×™× ××™, ×•×‘× ×•×¡×£ ××ª ×”×©×“×•×ª ×”×§×‘×•×¢×™× ×•×”×¢×¨×•×ª
        const inputs = Array.from(document.querySelectorAll('#orderForm input[type="text"]:not([disabled]), #orderForm textarea:not([disabled])'));
        
        inputs.forEach((currentField, index) => {
            currentField.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && currentField.tagName !== 'TEXTAREA') {
                    event.preventDefault();
                    
                    const nextIndex = index + 1;
                    if (nextIndex < inputs.length) {
                        const nextField = inputs[nextIndex];
                        nextField.focus();
                        if (nextField.tagName === 'TEXTAREA') {
                            nextField.setSelectionRange(nextField.value.length, nextField.value.length);
                        }
                    } else {
                        // ×× ×–×” ×”×©×“×” ×”××—×¨×•×Ÿ, × ×× ×¢ ××©×œ×™×—×ª ×˜×•×¤×¡
                        document.getElementById('notes').focus(); 
                    }
                }
            });
        });
    }

    // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×•×‘×™×˜×•×œ ×§×˜×’×•×¨×™×” (×›×•×ª×¨×ª ××• ×¡×¢×™×£)
    function clearSection(sectionId) {
        const sectionElement = document.getElementById(sectionId + '-section');
        if (!sectionElement) return;

        const isCancelled = sectionElement.classList.toggle('cancelled');
        
        // ××¦×™××ª ×›×œ ×©×“×•×ª ×”×§×œ×˜ ×‘×ª×•×š ×”×§×˜×’×•×¨×™×”
        const inputFields = sectionElement.querySelectorAll('input[type="text"], textarea');
        
        inputFields.forEach(input => {
            if (isCancelled) {
                input.value = '';
                input.setAttribute('disabled', 'true');
            } else {
                input.removeAttribute('disabled');
            }
        });
    }

    // ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×“×™× ××™ ×©×œ ×©×“×•×ª ×”×§×œ×˜
    function renderDynamicContent() {
        const dynamicSection = document.getElementById('dynamic-content-section');
        const mainTitleElement = document.getElementById('main-form-title');

        if (!dynamicSection || !activeConfig) {
            dynamicSection.innerHTML = '<p class="text-red-500">×©×’×™××ª ×˜×¢×™× ×ª ×ª×¦×•×¨×”. ×× × ×•×“×/×™ ××ª ×¤×¨××˜×¨ ×”-URL.</p>';
            return;
        }

        mainTitleElement.textContent = activeConfig.title;

        let html = '';
        activeConfig.fields.forEach(field => {
            // ×™×¦×™×¨×ª ××›×•×œ×” ×œ×›×œ ×§×˜×’×•×¨×™×” ×¢× ID ×™×™×—×•×“×™
            const sectionId = field.id;
            const labelText = `${field.label} (××§×¡×™××•× ${field.maxLen} ×ª×•×•×™× ×œ×©×•×¨×”):`;

            // ×›×¤×ª×•×¨ ×‘×™×˜×•×œ
            const clearButton = `<button type="button" onclick="clearSection('${sectionId}')" class="clear-button">ğŸ—‘ï¸ ×‘×˜×œ</button>`;

            // ×× ×©×“×” ×¨×‘-×©×•×¨×ª×™ (TextArea)
            if (field.isTextArea) {
                html += `
                <div id="${sectionId}-section" class="border border-transparent hover:border-gray-100 p-2 rounded-lg transition duration-150">
                    <div class="flex justify-between items-center mb-1">
                        <label for="${sectionId}" class="block text-sm font-medium text-gray-300">${labelText}</label>
                        ${clearButton}
                    </div>
                    <div class="form-group mb-6">
                        <textarea id="${sectionId}" class="input-style" rows="${field.lines}" maxlength="${field.maxLen}" placeholder="×”×§×œ×“ ×›××Ÿ..." ${field.defaultValue ? `value="${field.defaultValue}"` : ''}></textarea>
                    </div>
                </div>`;
            } else {
                // ×©×“×•×ª ×§×œ×˜ ×¨×’×™×œ×™× (Input type="text") - ×©×•×¨×” ××—×ª ××• ×™×•×ª×¨
                html += `
                <div id="${sectionId}-section" class="border border-transparent hover:border-gray-100 p-2 rounded-lg transition duration-150">
                    <div class="flex justify-between items-center mb-1">
                        <label for="${sectionId}-line1" class="block text-sm font-medium text-gray-300">${labelText}</label>
                        ${clearButton}
                    </div>`;

                for (let i = 1; i <= field.lines; i++) {
                    const lineId = `${sectionId}-line${i}`;
                    const placeholder = i > 1 ? `×©×•×¨×” ${i}` : '×”×§×œ×“ ×›××Ÿ...';
                    const initialValue = field.defaultValue && i === 1 ? field.defaultValue : '';
                    const extraClasses = field.isBold ? 'font-bold text-lg' : '';
                    const sectionClass = (field.maxLen === 30) ? 'section-input-style' : '';

                    html += `
                        <div class="form-group mb-2 ${i === field.lines ? 'mb-4' : ''}">
                            <input type="text" id="${lineId}" class="input-style ${extraClasses} ${sectionClass}" 
                                placeholder="${i > 1 ? '' : placeholder}" 
                                value="${initialValue}" maxlength="${field.maxLen}" required>
                        </div>
                    `;
                }
                html += `</div>`; // ×¡×’×™×¨×ª sectionId-section
            }
        });
        dynamicSection.innerHTML = html;
        setupEnterKeyNavigation(); // ×”×¤×¢×œ×ª × ×™×•×•×˜ ××—×“×© ×œ××—×¨ ×¨×™× ×“×•×¨
    }
    
    // ×¤×•× ×§×¦×™×” ×œ××™×¡×•×£ ×”× ×ª×•× ×™× ××”×˜×•×¤×¡ ×•×™×™×¦×•×× ×›×§×•×‘×¥ ×˜×§×¡×˜
    function saveFormAsText() {
        const fixedBroadcastDate = document.getElementById('fixed-broadcast-date').textContent;
        const editionName = document.getElementById('edition-name').value;
        
        let textContent = `× ×•×©×: ${activeConfig.title} (××”×“×•×¨×ª ${fixedBroadcastDate})
----------------------------------------
×¤×¨×˜×™ ×”×–×× ×”:
×©× ×”×©×•×œ×—/×›×ª×‘: ${document.getElementById('sender-name').value || '[×œ× ××•×œ×]'}
×©× ×”××”×“×•×¨×”: ${editionName || '[×œ× ××•×œ×]'}
×ª××¨×™×š ×©×™×“×•×¨: ${fixedBroadcastDate}
×©×¢×ª ×©×™×“×•×¨ ××©×•×¢×¨×ª: ${document.getElementById('fixed-estimated-time').textContent}
----------------------------------------
×§×‘×¦×™× ××¦×•×¨×¤×™× (×¡××Ÿ ×‘-X ×× ×¨×œ×•×•× ×˜×™):
${Array.from(document.querySelectorAll('.attachment-checkbox')).map(checkbox => checkbox.checked ? `[X] ${checkbox.nextElementSibling.textContent}` : `[ ] ${checkbox.nextElementSibling.textContent}`).join('\n')}
----------------------------------------
×ª×•×›×Ÿ ×”×’×¨×¤×™×§×” (× × ×œ××œ× ×‘××“×•×™×§):
\n`;

        activeConfig.fields.forEach(field => {
            const sectionId = field.id;
            const sectionElement = document.getElementById(sectionId + '-section');
            
            textContent += `${field.label}:\n`;

            if (sectionElement && sectionElement.classList.contains('cancelled')) {
                textContent += `[××‘×•×˜×œ]\n`;
                return;
            }

            if (field.isTextArea) {
                const value = document.getElementById(sectionId).value.trim();
                textContent += `${value || '[×œ× ××•×œ×]'}\n\n`;
            } else {
                let sectionContent = [];
                for (let i = 1; i <= field.lines; i++) {
                    const lineId = `${sectionId}-line${i}`;
                    const input = document.getElementById(lineId);
                    if (input && input.value.trim()) {
                        sectionContent.push(input.value.trim());
                    }
                }
                textContent += `${sectionContent.join('\n') || '[×œ× ××•×œ×]'}\n\n`;
            }
        });

        textContent += `----------------------------------------
×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×œ×’×¨×¤×™×§××™ (×¦×‘×¢×™×/×¡×’× ×•×Ÿ/×“×’×©×™×):
${document.getElementById('notes').value || '[××™×Ÿ ×”×¢×¨×•×ª]'}
`;

        // ×™×¦×™×¨×ª ×§×•×‘×¥ ×˜×§×¡×˜ ×•×”×•×¨×“×ª×•
        const filename = `×˜×•×¤×¡_×”×–×× ×”_${editionName || '×—×“×©'}_${fixedBroadcastDate}.txt`;
        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª ××¦×‘ ×ª×¦×•×’×”
    function toggleDarkMode() {
        const body = document.body;
        const toggleButton = document.querySelector('.mode-toggle-button');
        
        // ×”×”×™×’×™×•×Ÿ ×›××Ÿ ×”×¤×•×š: ×›×©×”××¦×‘ ×›×”×” (body.classList.contains('light-mode') == false), ×× ×—× ×• ××¦×™×’×™× ××ª ×”×œ×•×‘×™.
        // ×›×©×œ×•×—×¦×™×, ×× ×—× ×• ×¢×•×‘×¨×™× ×œ××¦×‘ ×‘×”×™×¨.
        
        const isCurrentlyLight = body.classList.toggle('light-mode');
        
        // ×©××™×¨×ª ×”×”×¢×“×¤×” ×©×œ ×”××©×ª××©
        localStorage.setItem('darkMode', isCurrentlyLight ? 'disabled' : 'enabled');

        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×”-Toggle
        toggleButton.textContent = isCurrentlyLight ? 'ğŸŒ— ××¦×‘ ×œ×™×œ×”' : 'â˜€ï¸ ××¦×‘ ×™×•×';
    }

    // ×”×¤×¢×œ×” ××•×˜×•××˜×™×ª ×©×œ ××¦×‘ ×›×”×” ×× × ×©××¨ ×‘-localStorage
    function applySavedMode() {
        const body = document.body;
        const toggleButton = document.querySelector('.mode-toggle-button');
        const savedMode = localStorage.getItem('darkMode');
        
        if (savedMode === 'disabled') {
            // ×× ×”××©×ª××© ×©××¨ ××¦×‘ ×‘×”×™×¨, × ×¢×‘×•×¨ ×œ××¦×‘ ×‘×”×™×¨ (×©××™× ×• ×‘×¨×™×¨×ª ×”××—×“×œ)
            body.classList.add('light-mode');
            toggleButton.textContent = 'ğŸŒ— ××¦×‘ ×œ×™×œ×”';
        } else {
            // ×× ×”××©×ª××© ×©××¨ ××¦×‘ ×›×”×”, ××• ×©×œ× ×©××¨ ×›×œ×•×, × ×©××¨ ×‘××¦×‘ ×‘×¨×™×¨×ª ×”××—×“×œ (×›×”×”)
             toggleButton.textContent = 'â˜€ï¸ ××¦×‘ ×™×•×';
        }
        
        // ×ª×™×§×•×Ÿ ×¦×‘×¢ ×”×›×¤×ª×•×¨×™× ×¢×‘×•×¨ ××¦×‘ ×‘×”×™×¨/×›×”×” ×“×™× ××™ (×›×™ Tailwind ×œ× ×™×•×“×¢ ×¢×œ ×”-JS)
        if (body.classList.contains('light-mode')) {
             toggleButton.classList.remove('bg-gray-600', 'hover:bg-gray-500', 'text-white');
             toggleButton.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');

             document.querySelector('.action-button').classList.remove('text-white');
             document.querySelector('.action-button').classList.add('text-black');

        } else {
             toggleButton.classList.add('bg-gray-600', 'hover:bg-gray-500', 'text-white');
             document.querySelector('.action-button').classList.remove('text-black');
             document.querySelector('.action-button').classList.add('text-white');
        }
    }

    // ×˜×¢×™× ×ª ×ª×¦×•×¨×” ×¨××©×•× ×™×ª ××”-URL
    function loadInitialConfig() {
        const urlParams = new URLSearchParams(window.location.search);
        const templateId = urlParams.get('template');
        
        if (templateId && templateConfigs[templateId]) {
            activeConfig = templateConfigs[templateId];
            document.title = activeConfig.title;
        }
        renderDynamicContent();
    }
    
    // ×”×¤×¢×œ×ª ×¢×“×›×•×Ÿ ×”×©×¢×” ×•×”×ª××¨×™×š ×›×œ ×©× ×™×™×”, ×•×”×—×œ×ª ××¦×‘ ×©××•×¨ ×‘×¢×ª ×˜×¢×™× ×”
    window.onload = function() {
        loadInitialConfig();
        applySavedMode();
        updateLiveDateTime();
        setInterval(updateLiveDateTime, 1000);
    };
</script>

</body>
</html>